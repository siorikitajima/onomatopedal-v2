<script>
    var thepedal = <%- JSON.stringify(pedal) %> ;
    var onomato = thepedal[0].onomato.toUpperCase().replace(/\s+/g, '');
    var disableKeys = false;
    var globalR = 90, globalG = 80, globalB = 80;
    var colNum = 1;
    var rSw = true, gSw = true, bSw = true;
    
    class Particle {
      constructor(r, g, b){
        this.x = random(0, width);
        this.y = random(0, height);
        this.r = r;
        this.g = g;
        this.b = b;
        this.d = 2;
        this.xSpeed = random(-2.5,2);
        this.ySpeed = random(-2,2.5);
      }
      createParticle() {
        noStroke();
        noFill();
        circle(this.x,this.y,this.d);
      }
      moveParticle() {
        if(this.x < 0 || this.x > width)
          this.xSpeed*=-1;
        if(this.y < 0 || this.y > height)
          this.ySpeed*=-1;
        this.x+=this.xSpeed;
        this.y+=this.ySpeed;
      }
      joinParticles(particles) {
        particles.forEach(element =>{
          let dis = dist(this.x,this.y,element.x,element.y);
          if(dis<150) {
            strokeWeight(1);
            stroke('rgb(' + globalR + ',' + globalG + ',' + globalB + ')');
            line(this.x,this.y,element.x,element.y);
          }
        });
      }
    }
    class WideBar {
      constructor(y,r,b,g) {
        this.x = 0;
        this.y = y;
        this.w = width;
        this.h = height/4;
        this.r = r;
        this.g = g;
        this.b = b;
        this.speed = 50;
      }
      createWideBar() {
        noStroke();
        fill(this.r, this.g, this.b);
        rect(this.x, this.y, this.w, this.h);
      }
      goDown(arrayName) {
        this.y+=this.speed;
        if(this.y > height) arrayName.splice(0, 1);
      }
      goUp(arrayName) {
        this.y-=this.speed;
        if(this.y < 0) arrayName.splice(0, 1);
      }
    }
    
    class OnoLetter {
      constructor(r, g, b) {
        this.x = random(0, width);
        this.y = random(0, height);
        this.r = r;
        this.g = g;
        this.b = b;
        this.ol = onomato[floor(random(0, onomato.length -1))];
        this.size = random(width/3, width/1.5);
      }
      createOnoLetter() {
        noStroke();
        fill(this.r, this.g, this.b);
        textSize(this.size);
        textAlign(CENTER);
        text(this.ol, this.x, this.y);
      }
      deleteOnoLetter(arrayName) {
        arrayName.splice(0, 1);
      }
    }
    
    class LineCircle {
      constructor(r, g, b, fill) {
        this.x = random(0, width);
        this.y = random(0, height);
        this.d = random(width/3, width/1.5);
        this.r = r;
        this.g = g;
        this.b = b;
        this.fill = fill;
        this.speed = 30;
        this.stroke = random(4,10);
      }
      createCircle() {
        stroke(this.r, this.g, this.b);
        strokeWeight(this.stroke);
        if(this.fill) {fill(this.r, this.g, this.b);}
        else {noFill();}
        ellipseMode(CENTER);
        circle(this.x, this.y, this.d);
      }
      shrinkCircle(arrayName) {
        this.d -= this.speed;
        if(this.d < 0) arrayName.splice(0, 1);
      }
    }
    
    let particles = [];
    let wideBars = [];
    let onoLetters = [];
    let lineCircles = [];
    
    function setup() {
      createCanvas(windowWidth, windowHeight);
      background('rgb(10,10,10)');
      frameRate(24);
      for(let i = 0;i<width/20;i++){
        particles.push(new Particle(random(0,width),random(0,height), globalR, globalG, globalB));
      }
      let pads = selectAll('.pad');
    }
    
    function draw() {
      // background('rgba(15,15,15,0.01)');
      background('rgba(15,15,15,0.02)');
      for(let i = 0;i<particles.length;i++) {
        particles[i].createParticle();
        particles[i].moveParticle();
        particles[i].joinParticles(particles.slice(i));
      }
      for(let i = 0;i<wideBars.length;i++) {
        wideBars[i].createWideBar();
        wideBars[i].goDown(wideBars);
      }
      for(let i = 0;i<onoLetters.length;i++) {
        onoLetters[i].createOnoLetter();
        onoLetters[i].deleteOnoLetter(onoLetters);
      }
      for(let i = 0;i<lineCircles.length;i++) {
        lineCircles[i].createCircle();
        lineCircles[i].shrinkCircle(lineCircles);
      }
    
      if (globalR >= 200) {rSw = false;}
      if (globalR <= 10) {rSw = true;}
      if (globalG >= 200) {gSw = false;}
      if (globalG <= 10) {gSw = true;}
      if (globalB >= 200) {bSw = false;}
      if (globalB <= 10) {bSw = true;}
    
        if (rSw){globalR = globalR + colNum;
        } else {globalR = globalR - colNum;}
        if (gSw){globalG = globalG + colNum;
        } else {globalG = globalG - colNum;}
        if (bSw){globalB = globalB + colNum;
        } else {globalB = globalB - colNum;}
    }
    
    function touchStarted() {
      let posx = floor(mouseX);
      let posy = floor(mouseY);
      let col1 = posx >= 0 && posx < width/3;
      let col2 = posx >= width/3 && posx < width/3*2;
      let col3 = posx >= width/3*2 && posx <= width;
      let row1 = posy >= 0 && posy < height/10;
      let row2 = posy >= height/10 && posy < height/10*2;
      let row3 = posy >= height/10*2 && posy < height/10*3;
      let row4 = posy >= height/10*3 && posy < height/10*4;
      let row5 = posy >= height/10*4 && posy < height/10*5;
      let row6 = posy >= height/10*5 && posy < height/10*6;
      let row7 = posy >= height/10*6 && posy < height/10*7;
      let row8 = posy >= height/10*7 && posy < height/10*8;
      let row9 = posy >= height/10*8 && posy < height/10*9;
    
      if ((col2 && row4) || (col3 && row8)) {
        globalR = globalR + 10;
        for(var i=0;i<5;i++) {
          particles.push(new Particle(globalR, globalG, globalB));
        }
      }
      if ((col1 && row5) || (col1 && row7)) {
        globalG = globalG + 10;
        for(var i=0;i<5;i++) {
          particles.push(new Particle(globalR, globalG, globalB));
        }
      }
      if ((col3 && row5) || (col2 && row3)) {
        globalB = globalB + 10;
        for(var i=0;i<5;i++) {
          particles.push(new Particle(globalR, globalG, globalB));
        }  }
      if ((col2 && row6) || (col1 && row1)) {
        globalR = 20; globalG = 10; globalB = 10;   
        for(var i=0;i<5;i++) {
          particles.push(new Particle(globalR, globalG, globalB));
        }  }
      if ((col2 && row9) || (col3 && row1)) {
        globalR = 190; globalG = 180; globalB = 180;
        for(var i=0;i<5;i++) {
          particles.push(new Particle(globalR, globalG, globalB));
        }
      }
      if ((col1 && row4) || (col1 && row2) || (col2 && row7)) {
        var r = 10, g = 10, b = 10;
        onoLetters.push(new OnoLetter(r, g, b));
      }
      if ((col3 && row4) || (col1 && row3) || (col2 && row2)) {
        var r = globalR, g = globalG, b = globalB;
        onoLetters.push(new OnoLetter(r, g, b));
      }
      if ((col2 && row8) || (col2 && row1) || (col3 && row6)) {
        var r = 10, g = 10, b = 10;
        lineCircles.push(new LineCircle(r, g, b, false));
      }
      if ((col3 && row7) || (col3 && row2) || (col1 && row9)) {
        var r = 10, g = 10, b = 10;
        lineCircles.push(new LineCircle(r, g, b, true));
      }
      if ((col1 && row8) || (col1 && row6)) {
        var r = globalR, g = globalG, b = globalB;
        lineCircles.push(new LineCircle(r, g, b, true));
      }
      if ((col2 && row5) || (col3 && row3)) {
        var r = globalR, g = globalG, b = globalB;
        lineCircles.push(new LineCircle(r, g, b, false));
      }
      if (col3 && row9) {
        wideBars.push(new WideBar(0,10,10,10));
      }
    
      if(width < 450) {
        if(particles.length > 20) {
        var extraParticles = particles.length + 1 - 20;
        particles.splice(0, extraParticles);
        }
      } else if(width < 800) {
        if(particles.length > 40) {
        var extraParticles = particles.length + 1 - 40;
        particles.splice(0, extraParticles);
        }
      } else {
        if(particles.length > 80) {
        var extraParticles = particles.length + 1 - 80;
        particles.splice(0, extraParticles);
      }
      }
    }
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }
      </script>